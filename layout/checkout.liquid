<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkout | {{ shop.name }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Ads Global Site Tag -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-360945425"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());

    // Google Ads Conversion ID
    gtag('config', 'AW-360945425');
  </script>

  {% if checkout %}
    <script>
      // ----------------------------
      // BEGIN CHECKOUT EVENT
      // ----------------------------
      {% if checkout.step == "contact_information" %}
        console.log('ðŸ”µ Begin Checkout');
        gtag('event', 'begin_checkout', {
          send_to: 'AW-360945425',
          value: {{ checkout.subtotal_price | money_without_currency }},
          currency: '{{ checkout.currency }}',
          items: [
            {% for item in checkout.line_items %}
              {
                id: '{{ item.product_id }}',
                name: '{{ item.title | escape }}',
                quantity: {{ item.quantity }},
                price: {{ item.price | money_without_currency }}
              }{% unless forloop.last %},{% endunless %}
            {% endfor %}
          ]
        });
      {% endif %}

      // ----------------------------
      // CHECKOUT PAGE LOADED
      // ----------------------------
      console.log('ðŸŸ  Checkout Page Loaded');

      // ----------------------------
      // PURCHASE EVENT
      // ----------------------------
      {% if template == 'checkout thank_you' %}
        console.log('ðŸŸ¢ Purchase Completed');
        console.log('Transaction ID:', '{{ checkout.order_number }}');
        console.log('Amount:', '{{ checkout.total_price | money_without_currency }}');
        console.log('Email:', '{{ checkout.email }}');

        gtag('event', 'purchase', {
          send_to: 'AW-360945425/6xrrCP7EpvIaEJGujqwB',
          transaction_id: '{{ checkout.order_number }}',
          value: {{ checkout.total_price | money_without_currency }},
          currency: '{{ checkout.currency }}',

          // Enhanced Conversion Data
          email: '{{ checkout.email | strip | downcase }}',
          first_name: '{{ checkout.billing_address.first_name | escape }}',
          last_name: '{{ checkout.billing_address.last_name | escape }}',
          phone_number: '{{ checkout.billing_address.phone | escape }}',
          address: {
            street: '{{ checkout.billing_address.address1 | escape }}',
            city: '{{ checkout.billing_address.city | escape }}',
            region: '{{ checkout.billing_address.province | escape }}',
            postal_code: '{{ checkout.billing_address.zip | escape }}',
            country: '{{ checkout.billing_address.country_code | escape }}'
          }
        });
      {% endif %}
    </script>
  {% endif %}

  {{ content_for_header }}
</head>

<body>
  {{ content_for_layout }}
</body>
</html>



