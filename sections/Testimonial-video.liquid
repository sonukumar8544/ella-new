<style>
            #video_{{ section.id }}{
               padding: 3rem 1.5rem;
               background-color: white;
             }

            #video_{{ section.id }} .section-heading {
               text-align: center;
               font-size: 2rem;
               font-style: italic;
               font-weight: 300;
             }

            #video_{{ section.id }} .section-heading .font-semibold {
               font-weight: 600;
             }

            #video_{{ section.id }} .section-subheading {
               text-align: center;
               color: #4B5563;
               margin: 0.5rem 0 2rem;
             }
            #video_{{ section.id }} .video-wrapper img.video__poster {
             cursor: pointer;
             max-height: 435px;
             width: inherit;
             object-fit: cover;
           }
            #video_{{ section.id }} .video-scroll-container {
               display: flex;
               overflow-x: auto;
               gap: 1rem;
               padding-bottom: 1rem;
               scroll-snap-type: x mandatory;
               -ms-overflow-style: none;
               scrollbar-width: none;
             }

            #video_{{ section.id }} .video-scroll-container::-webkit-scrollbar {
               display: none;
             }

            #video_{{ section.id }} .video-card {
               flex: 0 0 300px;
               background-color: white;
               border-radius: 12px;
               box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
               overflow: hidden;
               scroll-snap-align: start;
               display: flex;
               flex-direction: column;
               transition: transform 0.3s;
               position: relative;
             }

             #video_{{ section.id }} .video-wrapper {
               width: 100%;
               height: auto;
               overflow: hidden;
             }

             #video_{{ section.id }} .video-wrapper video {
               width: 100%;
               height: auto;
               display: block;
               object-fit: cover;
             }

   #video_{{ section.id }}  svg.youtube__icon_svg {
              position: absolute;
              top: 50%;
              left: 50%;
              fill: #d6d6d6;
              stroke: #ffffff00;
              width: 36px;
              height: 35px;
              transform: translate(-50%, -50%);
              background: #000;
              border-radius: 50%;
              padding: 5px;
            }


            #video_{{ section.id }} .card-content {
               position: absolute;
               bottom: 0;
               left: 0;
               right: 0;
               padding: 0.8rem;
               display: flex;
               justify-content: space-between;
               align-items: center;
               gap: 10px;
               backdrop-filter: blur(10px);
               background: #ffffff5c;
               margin: 0px;
               border-top-left-radius: 0;
                border-top-right-radius: 0;
                border-bottom-left-radius: 12px;
                border-bottom-right-radius: 12px;
                }
                .card-content.cstm_tesimonail_video.second_video_product {
                bottom: 96px !important;border-radius: 0 !important;
                }

            #video_{{ section.id }} .cstm_tesimonail_video .product-img {
               width: 80px;
               height: auto;
               border-radius: 4px;
             }

            #video_{{ section.id }} .cstm_tesimonail_video .product-title {
             font-weight: 600;
             font-size: 13px;
             margin: 0;
             color: #000;
             line-height: 1.2;
         }

              #video_{{ section.id }} .cstm_tesimonail_video .product-price {
               font-size: 12px;
               margin: 0px 0px 3px;
               color: #000000;
               font-weight: 800;
               letter-spacing: unset;
               }

               #video_{{ section.id }} .cstm_tesimonail_video .cst_atc_button_testimonail {
               background-color: #086b92;
               color: white;
               padding: 8px 16px;
               border: none;
               border-radius: 4px;
               cursor: pointer;
               border: 1px solid #086b92;
               font-size: 12px;
               font-weight: 600;
               text-transform: uppercase;
               }

            #video_{{ section.id }} .cstm_tesimonail_video .cst_atc_button_testimonail:hover {
               background-color: #055671;
             }

             #video_{{ section.id }} .product-title-new {
               width: 200px;
             }
         #video_{{ section.id }}  .video_popup_init .video_popup_grid video{
               border: none;
               outline: none;
               border-radius: 12px;
           cursor:pointer;
           }
         #video_{{ section.id }}  .video_popup_init .card-content{
                 position: relative;
               display: block;
           }
       .video_popup_init {
     display: none;
     transition: all 0.3s ease-in-out;
   }
  @media(min-width:768px){
   #video_{{ section.id }} .video-wrapper img.video__poster {
             display:block !important;
           }
     #video_{{ section.id }} .video-wrapper .mobile_view_video{
        display:none !important;
     }
   }
   @media(max-width:767px){
   #video_{{ section.id }} .video-wrapper img.video__poster {
             display:none !important;
           }
     #video_{{ section.id }} .video-wrapper .mobile_view_video{
        display:block !important;
     }
     .video_popup_init{
       display:none !important;
     }
   }
</style>

<section class="video-section" id="video_{{ section.id }}">
  {% if section.settings.title != blank %}
    <h3 class="title">
      <span class="text">{{ section.settings.title }}</span>
    </h3>
  {% endif %}

  {% if section.settings.description != blank %}
    <div class="rte subtext-brand w-100 text-center">
      <p>{{ section.settings.description }}</p>
    </div>
  {% endif %}

  <div class="video-scroll-container">
    {% for video in section.blocks %}
      {% assign featured_product = video.settings.product %}
      {% assign featured_product1 = video.settings.product1 %}
      {% assign first_variant_id = featured_product.variants.first.id %}
      {% assign first_variant_id1 = featured_product1.variants.first.id %}
      {% if video.settings.video_poster != blank %}
        <div class="video-card">
          <div class="video-wrapper" data-modal="modal-{{ video.id }}">
            <img
              data-src="{{ video.settings.video_poster | img_url: '500x' }}"
              src="{{ video.settings.video_poster | img_url: '100x' }}"
              alt="{{ }}"
              width="100%"
              height="100%"
              class="video__poster lazyload"
            >
            <video
              class="mobile_view_video"
              muted
              loop
              playsinline
              style="width: 100%; height: auto; cursor: pointer;"
            >
              <source src="{{ video.settings.video }}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
            <svg
              class="youtube__icon_svg"
              xmlns="http://www.w3.org/2000/svg"
              width="32"
              height="32"
              viewBox="0 0 24 24"
              fill="red"
            >
              <path d="M19.615 3.184C21.068 3.585 22.003 4.768 22 6.273V17.73C22.003 19.236 21.068 20.419 19.615 20.82C17.559 21.4 12 21.4 12 21.4C12 21.4 6.441 21.4 4.385 20.82C2.932 20.419 1.997 19.236 2 17.73V6.273C1.997 4.768 2.932 3.585 4.385 3.184C6.441 2.6 12 2.6 12 2.6C12 2.6 17.559 2.6 19.615 3.184ZM10 16.2L16 12L10 7.8V16.2Z"/>
            </svg>
          </div>

          {% if video.settings.product != blank %}
            <div class="card-content cstm_tesimonail_video" data-product-id="{{ featured_product.id }}">
              <img
                data-src="{{ featured_product.featured_image | img_url: 'small' }}"
                src="{{ featured_product.featured_image | img_url: '20x' }}"
                alt="{{ featured_product.title }}"
                width="100%"
                height="100%"
                class="product-img lazyload"
              >
              <div class="product-title-new">
                <p class="product-title">{{ featured_product.title | truncate: 30 }}</p>
                <p class="product-price">{{ featured_product.price | money_with_currency }}</p>
                <button
                  type="submit"
                  name="add"
                  class="cst_atc_button_testimonail product1"
                  data-variant-ids="{{ first_variant_id | strip }}"
                >
                  Add To Cart
                </button>
              </div>
            </div>
          {% endif %}
          {% if video.settings.product1 != blank %}
            <div
              class="card-content cstm_tesimonail_video  {% if featured_product1 %}second_video_product{% endif %}"
              data-product-id1="{{ featured_product1.id }}"
            >
              <img
                data-src="{{ featured_product1.featured_image | img_url: 'small' }}"
                src="{{ featured_product1.featured_image | img_url: '20x' }}"
                alt="{{ featured_product1.title }}"
                width="100%"
                height="100%"
                class="product-img lazyload"
              >

              <div class="product-title-new">
                <p class="product-title">{{ featured_product1.title | truncate: 30 }}</p>
                <p class="product-price">{{ featured_product1.price | money_with_currency }}</p>

                <button
                  type="submit"
                  name="add"
                  class="cst_atc_button_testimonail product2"
                  data-variant-ids="{{ first_variant_id1 | strip }}"
                >
                  Add To Cart
                </button>
              </div>
            </div>
          {% endif %}
        </div>
        {% render 'popup_video_product',
          video: video,
          featured_product: video.settings.product,
          featured_product1: video.settings.product1,
          first_variant_id: featured_product.variants.first.id,
          first_variant_id1: featured_product1.variants.first.id
        %}
      {% endif %}
    {% endfor %}
  </div>
</section>
<script>
  $(document).ready(function () {
    // Open popup when .video-wrapper is clicked
    $('body').on('click', '.video-wrapper', function () {
      var modalId = $(this).data('modal');
      $('#' + modalId).fadeIn();
    });

    // Close popup when close button is clicked
    $('body').on('click', '.halo-sidebar-close', function (e) {
      e.preventDefault();
      e.stopPropagation();

      var popup = $(this).closest('.video_popup_init');
      popup.fadeOut();

      // Pause all videos inside the popup
      popup.find('video').each(function () {
        this.pause();
      });
    });

    // Close popup when clicking outside the .video_popup content
    $('body').on('click', '.video_popup_init', function (e) {
      if ($(e.target).closest('.video_popup').length === 0) {
        $(this).fadeOut();

        // Pause all videos when closing by background click
        $(this).find('video').each(function () {
          this.pause();
        });
      }
    });


  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const wrappers = document.querySelectorAll(".video-wrapper");

    wrappers.forEach(wrapper => {
      const video_mobile = wrapper.querySelector(".mobile_view_video");
      const youtubeIcon = wrapper.querySelector(".youtube__icon_svg");

      function toggleVideo() {
        if (video_mobile.paused) {
          video_mobile.muted = false; // Unmute when playing
          video_mobile.play();
          youtubeIcon.style.display = "none";
        } else {
          video_mobile.pause();
          youtubeIcon.style.display = "block";
        }
      }

      video_mobile.addEventListener("click", toggleVideo);
      youtubeIcon.addEventListener("click", toggleVideo);
    });
  });
</script>

{% schema %}
{
  "name": "Video Product Cards",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Voices of Satisfaction"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Content"
    }
  ],
  "blocks": [
    {
      "type": "product_card",
      "name": "Custom Product Card",
      "settings": [
         {
          "type": "image_picker",
          "id": "video_poster",
          "label": "Video Poster"
        },
        {
          "type": "url",
          "id": "video",
          "label": "Video URL"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Product1"
        },
         {
          "type": "product",
          "id": "product1",
          "label": "Product2"
        }

      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonial Video | App"
    }
  ]
}
{% endschema %}
